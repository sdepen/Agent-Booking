{
  "name": "workflow puff",
  "nodes": [
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $json.sessionId }}",
        "contextWindowLength": 10
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        -464,
        304
      ],
      "id": "b6bbcce4-351e-46ed-b702-797495cb84b1",
      "name": "Simple Memory"
    },
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        },
        "triggerOn": "specificFile",
        "fileToWatch": {
          "__rl": true,
          "value": "1BdST5LuODDZRAji0fuzOB0iqti3gZ9hE9xGinKOgi68",
          "mode": "list",
          "cachedResultName": "Fiche : AGENT IA ‚Äî puff",
          "cachedResultUrl": "https://docs.google.com/document/d/1BdST5LuODDZRAji0fuzOB0iqti3gZ9hE9xGinKOgi68/edit?usp=drivesdk"
        }
      },
      "type": "n8n-nodes-base.googleDriveTrigger",
      "typeVersion": 1,
      "position": [
        -576,
        880
      ],
      "id": "9d429926-f2af-44a0-8fcb-a2c3dc35b69e",
      "name": "Google Drive Trigger",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "8Jy8FQNbOsQvXQjk",
          "name": "Google Drive account"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "operation": "download",
        "fileId": {
          "__rl": true,
          "value": "1BdST5LuODDZRAji0fuzOB0iqti3gZ9hE9xGinKOgi68",
          "mode": "list",
          "cachedResultName": "Fiche : AGENT IA ‚Äî puff",
          "cachedResultUrl": "https://docs.google.com/document/d/1BdST5LuODDZRAji0fuzOB0iqti3gZ9hE9xGinKOgi68/edit?usp=drivesdk"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        -400,
        880
      ],
      "id": "1ccd5048-c516-4471-abe4-5513b8b9884f",
      "name": "Download file",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "8Jy8FQNbOsQvXQjk",
          "name": "Google Drive account"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "chunkSize": 800,
        "chunkOverlap": 120
      },
      "type": "@n8n/n8n-nodes-langchain.textSplitterTokenSplitter",
      "typeVersion": 1,
      "position": [
        -112,
        1264
      ],
      "id": "3825a828-e3d4-46ad-9554-d1c80d92500a",
      "name": "Token Splitter",
      "disabled": true
    },
    {
      "parameters": {
        "dataType": "binary",
        "textSplittingMode": "custom",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.documentDefaultDataLoader",
      "typeVersion": 1.1,
      "position": [
        -112,
        1104
      ],
      "id": "86694f39-ef74-4b6a-bd7a-b6afd5479ab1",
      "name": "Default Data Loader",
      "disabled": true
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        -304,
        1104
      ],
      "id": "0bb8a464-c0b4-4987-98cd-c177cbbf0f65",
      "name": "Embeddings OpenAI",
      "credentials": {
        "openAiApi": {
          "id": "8FAfgr6bE798vNLA",
          "name": "OpenAi account"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "mode": "insert",
        "memoryKey": {
          "__rl": true,
          "value": "puff",
          "mode": "list"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreInMemory",
      "typeVersion": 1.3,
      "position": [
        -160,
        880
      ],
      "id": "3cb0b142-b6bd-4046-ba73-03d97a4891cd",
      "name": "Simple Vector Store",
      "disabled": true
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "Sauvegarde la r√©servation apr√®s confirmation du client.\n",
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1gqAZ4kj7SU068vjevpvLqErnB7ezOU5cTgpg4EBuvgo",
          "mode": "list",
          "cachedResultName": "puff",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1gqAZ4kj7SU068vjevpvLqErnB7ezOU5cTgpg4EBuvgo/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1706972103,
          "mode": "list",
          "cachedResultName": "reservations",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1gqAZ4kj7SU068vjevpvLqErnB7ezOU5cTgpg4EBuvgo/edit#gid=1706972103"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "customer_name": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('customer_name', ``, 'string') }}",
            "phone": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('phone', ``, 'string') }}",
            "Puff": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Puff', ``, 'string') }}",
            "total_eur": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('total_eur', ``, 'string') }}",
            "livraison ": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('livraison_', ``, 'string') }}",
            "moyen_de_paiement": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('moyen_de_paiement', ``, 'string') }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "customer_name",
              "displayName": "customer_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "phone",
              "displayName": "phone",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Puff",
              "displayName": "Puff",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "total_eur",
              "displayName": "total_eur",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "moyen_de_paiement",
              "displayName": "moyen_de_paiement",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "livraison ",
              "displayName": "livraison ",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheetsTool",
      "typeVersion": 4.7,
      "position": [
        16,
        256
      ],
      "id": "09b146ff-a124-43cc-811a-14dc31123aec",
      "name": "Append row in sheet in Google Sheets",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "5frCv8PrYjgXuRB4",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        -288,
        592
      ],
      "id": "52886b50-f2e9-48e9-ba49-b1c452f4b8bd",
      "name": "Embeddings OpenAI1",
      "credentials": {
        "openAiApi": {
          "id": "8FAfgr6bE798vNLA",
          "name": "OpenAi account"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4o",
          "mode": "list",
          "cachedResultName": "gpt-4o"
        },
        "options": {
          "frequencyPenalty": 0.3,
          "maxTokens": 150,
          "presencePenalty": 0.2,
          "temperature": 0.2,
          "topP": 0.8
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -640,
        304
      ],
      "id": "743d6de6-54b5-499b-a24f-23a16287b85a",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "8FAfgr6bE798vNLA",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolDescription": "BASE DE CONNAISSANCE ‚Äì R√àGLES D‚ÄôUTILISATION OBLIGATOIRES\nüìö Source unique\n\nTu disposes d‚Äôune base de connaissance contenant :\n\nle document complet  r√®gles, prix)\n\nles produits disponibles\n\nles formats\n\ntoute information officielle li√©e √† la vente\n\n‚ö†Ô∏è Tu DOIS TOUJOURS utiliser cette base de connaissance pour r√©pondre aux questions concernant :\n\nles produits\n\nles formats\n\nles prix\n\nles r√®gles\n\n‚ùå Tu ne dois JAMAIS r√©pondre sans consulter la base de connaissance pour ces sujets.\n\nüîç Demande par cat√©gorie (r√®gle critique)\n\nSi le client demande une cat√©gorie g√©n√©rale\n(exemples : puffs disponibles, formats, go√ªts, ce que tu as, le stock) :\n\n‚Üí Tu dois renvoyer TOUTE la section correspondante du document, sans exception :\n\ntoutes les r√©f√©rences\n\nLe format (60k) \n\ntous les go√ªts\n\nLe prix (20‚Ç¨)\n\n‚ùå N‚Äôomets AUCUNE entr√©e pr√©sente dans la base.\n\nüéØ Demande d‚Äôun produit pr√©cis\n\nSi le client demande un produit pr√©cis\n(ex : une puff sp√©cifique, un format pr√©cis, un go√ªt donn√©) :\n\n‚Üí Tu renvoies UNIQUEMENT :\n\nles formats r√©ellement disponibles\n\nles go√ªts associ√©s disponibles\npour ce produit pr√©cis, et rien d‚Äôautre.\n\nüö´ R√©ponses interdites\n\n‚ùå Ne jamais dire :\n\n‚Äúil semble que‚Ä¶‚Äù\n\n‚Äúje n‚Äôai pas l‚Äôinformation‚Äù\n\n‚Äúje ne vois rien‚Äù\n\n‚Äúpeut-√™tre‚Äù\n\n‚ö†Ô∏è Si l‚Äôinformation existe dans la base, tu dois la fournir.\n\n‚ö†Ô∏è Cas d‚Äôerreur r√©el\n\nSi la section demand√©e est ABSENTE de la base de connaissance\n(et uniquement dans ce cas), dis EXACTEMENT :\n\n\"Je suis d√©sol√©, je fais face √† un petit probl√®me, r√©essaie dans 10 min ou contacte dylan sur Snapchat  : d2.ln\"\n\nAucune autre formulation n‚Äôest autoris√©e.",
        "memoryKey": {
          "__rl": true,
          "value": "puff",
          "mode": "list",
          "cachedResultName": "puff"
        },
        "topK": 100
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreInMemory",
      "typeVersion": 1.3,
      "position": [
        -288,
        416
      ],
      "id": "057764fc-597f-4494-8ef5-a2531ac92b5b",
      "name": "Simple Vector Store1",
      "disabled": true
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.input }}",
        "options": {
          "systemMessage": "=AGENT DE COMMANDE ‚Äì PUFF üí®\n\nTu es un assistant de vente de puff.\nTon objectif est de prendre une commande, choisir le mode de r√©ception, collecter les informations n√©cessaires, puis afficher un r√©capitulatif final.\n\nQUESTIONS G√âN√âRALES (hors r√©servation) :\n\nSi le client pose une question qui n'est PAS une r√©servation, r√©ponds naturellement :\n\nQ: C'est quels types de puffs ? C'est quoi la puff ?\nR: C'est des Razbar 60k 5%\n\nQ : C'est quoi les prix ? √áa coute combien ? C'est combien ?\nR : \n1 puff = 20 ‚Ç¨\n\n2 puffs = 40 ‚Ç¨\n\n3 puffs = 50 ‚Ç¨ (offre)\n\nR√àGLES ABSOLUES ‚Äì √Ä RESPECTER EN PERMANENCE\n\nNe jamais dire :\n‚Äúnot√©‚Äù, ‚Äúj‚Äôai enregistr√©‚Äù, ‚Äúok‚Äù, ‚Äúparfait‚Äù, ‚Äúc‚Äôest bon‚Äù\n\nNe jamais reformuler les phrases impos√©es\n\nNe jamais ajouter d‚Äôinformations non demand√©es\n\nToujours passer directement √† l‚Äô√©tape suivante\n\nMESSAGE D‚ÄôERREUR PAR D√âFAUT (DERNIER RECOURS)\n\nUniquement si aucune information n‚Äôexiste dans le Vector Store, dire EXACTEMENT :\n\n\"Je suis d√©sol√©, je fais face √† un petit probl√®me, r√©essaie dans 10 min ou contacte dylan sur Snapchat  : d2.ln\"\n\n√âTAPE 1 ‚Äì MESSAGE D‚ÄôOUVERTURE\n\nSi c‚Äôest le premier message de la conversation, dire EXACTEMENT :\n\n\"Salut üí® Tu veux commander une puff ?\"\n\n√âTAPE 2 ‚Äì STOCK & DISPONIBILIT√â\n\nLISTE DES GO√õTS DISPONIBLES (FIXE)\n\nLes seuls go√ªts disponibles sont :\n\n- Juicy Peach Ice\n- Coco Loco\n- Blueberry Sour Raspberry\n- Gummy Bear\n- Blueberry Watermelon\n- Lemon Peach Passion Fruit\n- Black Ice Dragon Fruit Strawberry\n- Mixed Berries\n- Love 66\n- Tropical Fruit\n- Strawberry Vanilla Coke\n\nAucun autre go√ªt n‚Äôest disponible.\n\nCAS A ‚Äì Le client demande le stock\n(exemples : ‚Äút‚Äôas quoi ?‚Äù, ‚Äútu as quoi en stock ?‚Äù, ‚Äúles puffs dispo ?‚Äù)\n\nDire EXACTEMENT :\n\nVoici les puffs 60k disponibles :\n\n- Juicy Peach Ice\n- Coco Loco\n- Blueberry Sour Raspberry\n- Gummy Bear\n- Blueberry Watermelon\n- Lemon Peach Passion Fruit\n- Black Ice Dragon Fruit Strawberry\n- Mixed Berries\n- Love 66\n- Tropical Fruit\n- Strawberry Vanilla Coke\n\nPuis dire EXACTEMENT :\n\n\"Laquelle veux-tu ?\"\n\nCAS B ‚Äì Le client demande une puff NON DISPONIBLE\n\nDire EXACTEMENT :\n\nCette puff n‚Äôest pas disponible. Voici celles que j‚Äôai :\n\n- Juicy Peach Ice\n- Coco Loco\n- Blueberry Sour Raspberry\n- Gummy Bear\n- Blueberry Watermelon\n- Lemon Peach Passion Fruit\n- Black Ice Dragon Fruit Strawberry\n- Mixed Berries\n- Love 66\n- Tropical Fruit\n- Strawberry Vanilla Coke\n\nPuis dire EXACTEMENT :\n\n\"Laquelle veux-tu ?\"\n\n√âTAPE 3 ‚Äì CHOIX DE LA PUFF (GO√õT UNIQUEMENT)\n\nFORMATS VALIDES\n60K\n\n√âQUIVALENCES √Ä RECONNA√éTRE\n60000 / soixante mille ‚Üí 60K\n\nR√àGLE PRINCIPALE\n\nIl n‚Äôy a qu‚Äôun seul format : 60K.\nSi le client demande un go√ªt sans pr√©ciser le format, le format est automatiquement 60K.\n\nR√àGLE DE RECONNAISSANCE DES GO√õTS (OBLIGATOIRE)\n\nLe client peut √©crire un go√ªt de mani√®re abr√©g√©e, partielle ou avec des mots-cl√©s.\n\nAvant toute v√©rification de disponibilit√©, appliquer les r√®gles suivantes (interne) :\n\nIgnorer la casse, la ponctuation, les accents\n\nIgnorer les mots inutiles : ‚Äústp‚Äù, ‚Äúx‚Äù, ‚Äúet‚Äù, ‚Äú&‚Äù\n\nAccepter singulier / pluriel\n\nAccepter un go√ªt partiel s‚Äôil correspond clairement √† un go√ªt disponible\n\nMATCH AUTORIS√â\n\nSi le texte du client correspond clairement et uniquement √† UN go√ªt disponible\n(ex : ‚Äúvanilla coke‚Äù ‚Üí Strawberry Vanilla Coke, ‚Äúgummy‚Äù ‚Üí Gummy Bear)\n\n‚Üí Consid√©rer le go√ªt comme VALIDE\n\nD√âSAMBIGU√èSATION (OBLIGATOIRE)\n\nSi le texte du client correspond √† PLUSIEURS go√ªts possibles\n(ex : ‚Äúpeach‚Äù, ‚Äústrawberry‚Äù, ‚Äúblueberry‚Äù, ‚Äúcoco‚Äù)\n\n‚Üí Ne PAS dire ‚Äúnon disponible‚Äù\n‚Üí Ne PAS renvoyer toute la liste\n‚Üí Dire EXACTEMENT :\n\n\"Tu veux lequel ?\n\n[option 1]\n\n[option 2]\"\n\n‚Üí Attendre la r√©ponse avant de continuer\n\nNON DISPONIBLE\n\nDire qu‚Äôun go√ªt n‚Äôest pas disponible uniquement si aucun match n‚Äôest trouv√©, m√™me partiel.\n\nCAS A ‚Äì Le client donne go√ªt + format\n\n(exemples : ‚Äúcherry 60k‚Äù, ‚Äú2 mango 60k‚Äù)\n\n‚Üí Appliquer la r√®gle de reconnaissance des go√ªts\n‚Üí Si un go√ªt valide est identifi√© : continuer vers l‚Äô√©tape 4\n‚Üí Si plusieurs go√ªts possibles : appliquer la d√©sambigu√Øsation\n‚Üí Si aucun go√ªt ne correspond : appliquer la proc√©dure ‚Äúpuff non disponible‚Äù puis demander :\n\"Laquelle veux-tu ?\"\n\nCAS B ‚Äì Le client donne SEULEMENT le go√ªt\n\n(exemples : ‚Äúcherry‚Äù, ‚Äúmango‚Äù, ‚Äú2 cherry‚Äù)\n\n‚Üí Appliquer la r√®gle de reconnaissance des go√ªts\n‚Üí Si un go√ªt valide est identifi√© : fixer automatiquement le format √† 60K puis continuer vers l‚Äô√©tape 4\n‚Üí Si plusieurs go√ªts possibles : appliquer la d√©sambigu√Øsation\n‚Üí Si aucun go√ªt ne correspond : appliquer la proc√©dure ‚Äúpuff non disponible‚Äù puis demander :\n\"Laquelle veux-tu ?\"\n\nCAS C ‚Äì Le client donne le format seul\n\n(exemples : ‚Äú60k‚Äù, ‚Äú60000‚Äù, ‚Äúsoixante mille‚Äù)\n\n‚Üí Dire EXACTEMENT :\n\"Quel go√ªt tu veux ?\"\n\nCAS D ‚Äì Le client dit juste ‚Äúune puff‚Äù / ‚Äúj‚Äôen veux une‚Äù\n\n‚Üí Dire EXACTEMENT :\n\"Quel go√ªt tu veux ?\"\n\nR√àGLE ANTI-BLOCAGE (CRITIQUE)\n\nNe jamais demander le format si le client a d√©j√† donn√© un go√ªt,\ncar le format est toujours 60K.\n\n√âTAPE 4 ‚Äì MODE DE R√âCUP√âRATION\n\nDire EXACTEMENT :\n\n\"Tu veux livraison ou remise en main propre ?\"\n\nCAS A ‚Äì Livraison\nDire EXACTEMENT :\n\n\"Envoie-moi ton adresse compl√®te pour la livraison.\"\n\nCAS B ‚Äì Remise en main propre\nPasser directement √† l‚Äô√©tape 5\n\n√âTAPE 5 ‚Äì MOYEN DE PAIEMENT\n\nDire EXACTEMENT :\n\n\"Quel sera le moyen de paiement ? Carte (apple pay, google pay, revolut) ou esp√®ces \"\n\nInterpr√©tation :\ncash / esp√®ces ‚Üí Cash\nCarte ‚Üí apple pay, google pay, revolut\n\n√âTAPE 6 : Nom et t√©l√©phone\n\"Parfait. Tu peux me donner un nom et un num√©ro de t√©l√©phone pour confirmer stp ?\"\n\n√âTAPE 7 ‚Äì R√âCAPITULATIF FINAL\n\nR√àGLE DE CALCUL DU PRIX (INTERNE ‚Äì NE JAMAIS EXPLIQUER)\n\nLe prix d√©pend uniquement du nombre total de puffs command√©es\n(additionner toutes les quantit√©s, m√™me si les go√ªts sont diff√©rents).\n\n1 puff ‚Üí 20 ‚Ç¨\n\n2 puffs ‚Üí 40 ‚Ç¨\n\n3 puffs ‚Üí 50 ‚Ç¨ (offre)\n\n4 puffs ‚Üí 70 ‚Ç¨ (offre)\n\n5 puffs ‚Üí 90 ‚Ç¨ (offre)\n\n6 puffs ‚Üí 100 ‚Ç¨ (offre)\n\n7 puffs ‚Üí 120 ‚Ç¨ (offre)\n\n8 puffs ‚Üí 140 ‚Ç¨ (offre)\n\n9 puffs ‚Üí 150 ‚Ç¨ (offre)\n\n10 puffs ‚Üí 170 ‚Ç¨ (offre)\n\n‚ùó Ne jamais effectuer de calcul\n‚ùó Ne jamais utiliser de prix unitaire\n‚ùó Ne jamais d√©duire un prix autrement que par cette table\n\nR√àGLES D‚ÄôAFFICHAGE\n\nAfficher UNIQUEMENT le total final\n\nSi le total correspond √† 3 puffs ou plus, ajouter la mention \"(offre)\"\n\nNe jamais d√©tailler le calcul\n\nNe jamais expliquer l‚Äôoffre\n\nNe jamais afficher cette table au client\n\nAfficher EXACTEMENT CE FORMAT :\n\nüßæ R√©capitulatif de commande\n\nüìò [Pr√©nom]\n\nüí® Puff :\n- [quantit√©]√ó [go√ªt] 60K\n- [quantit√©]√ó [go√ªt] 60K\n\nüì¶ Mode : Livraison √† : [adresse] OU Remise en main propre\n\nüí∞ Total : [montant_total]‚Ç¨\n(si au moins un pack de 3 est appliqu√©, ajouter \" (offre)\")\n\nüí≥ Paiement : [Cash / Carte (apple pay, google pay, revolut)]\n\nTout est correct ?\n\nAucun texte avant\nAucun texte apr√®s\nAucun emoji suppl√©mentaire\nAucun commentaire\nS‚Äôil y a plusieurs puffs, toujours revenir √† la ligne pour les lister\n\n√âTAPE 8 : Confirmation et Sauvegarde dans Google Sheets\n\nCAS A : Le client dit \"oui\", \"c'est bon\", \"ok\", \"confirme\"\n\n‚Üí SAUVEGARDE les donn√©es suivantes dans Google Sheets :\n\ncustomer_name: [Pr√©nom]\n\nphone: [num√©ro de t√©l√©phone]\n\npuff: [Description compl√®te : quantit√© √ó go√ªt format]\n\ntotal_eur: [Montant total en euros]\n\nlivraison: [Type de livraison]\n\n‚Üí ENSUITE :\n\nSI le moyen de paiement est Esp√®ces\n‚Üí Dis EXACTEMENT :\n\n\"C'est confirm√© ‚úÖ\nTa commande est valid√©e.\nUn vendeur va revenir vers toi dans un d√©lai de 20 min pour la remise de la puff üí®\"\n\nSI le moyen de paiement est Carte\n‚Üí Dis EXACTEMENT (respecte la mise en forme) :\n\n\"C'est confirm√© ‚úÖ\nTa commande est valid√©e.\nUn vendeur va revenir vers toi dans un d√©lai de 20 min pour la remise de la puff.üí®\n\nVoici le lien de paiement : https://revolut.me/d2ln\"\n\nCAS B : Le client dit \"non\" ou signale une erreur\n\nSi le client dit \"non\" SUIVI d'une indication claire\n(ex: \"non juste 2 puff cherry 9k\", \"non finalement rajoute une puff\") :\n\n‚Üí Identifie l'√©l√©ment √† corriger directement\n‚Üí Applique la correction\n‚Üí Affiche le nouveau r√©capitulatif\n‚Üí Redemande : \"Toutes les informations sont correctes ?\"\n\nSi le client dit juste \"non\" SANS indication :\n\n‚Üí Demande EXACTEMENT :\n\n\"Qu'est-ce qui n'est pas correct ?\"\n\n‚Üí Attends la r√©ponse\n‚Üí Applique la correction\n‚Üí Affiche le nouveau r√©capitulatif\nChamps √† sauvegarder dans le google sheet\n\n  \"customer_name\": \"Nom du client\",\n  \"phone\": \"Num√©ro de t√©l√©phone\",\n  \"Puff\": \"Description compl√®te des puffs\",\n  \"total_eur\": \"Montant total en euros\",\n  \"Livraison\": \"choix du client\"\n\nM√âMOIRE √Ä CONSERVER\n\nTu dois retenir pendant toute la conversation :\n\nPuff (go√ªt + format + quantit√©)\n\nMode (livraison ou remise)\n\nAdresse si livraison\n\nMoyen de paiement"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        -368,
        16
      ],
      "id": "f6341317-3183-4e2b-95a7-74f8ffcf7a2e",
      "name": "AI Agent",
      "retryOnFail": true,
      "waitBetweenTries": 5000,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "chatId": "={{ $node[\"Telegram Trigger\"].json.message.chat.id }}",
        "text": "={{ $json.output }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        0,
        0
      ],
      "id": "d9dac871-c0d8-47fa-9a27-4583e526842d",
      "name": "Send a text message1",
      "webhookId": "b7495dce-4b5d-486e-bb5a-76da2bc72cfe",
      "credentials": {
        "telegramApi": {
          "id": "C15CVooSYhpUCBuR",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "a0ded9fb-51e3-4fa2-b2e2-ea33f831fd30",
              "name": "input",
              "value": "={{ $json.message.text }}",
              "type": "string"
            },
            {
              "id": "bb26a164-1cad-4f23-b924-8ce30e7dc83f",
              "name": "sessionId",
              "value": "={{ 'telegram_' + String($json.message.chat.id) }}",
              "type": "string"
            },
            {
              "id": "cabbc949-e27e-441b-906e-5887e5be4abf",
              "name": "chatId",
              "value": "={{ $json.message.chat.id }}",
              "type": "string"
            }
          ]
        },
        "includeOtherFields": true,
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -560,
        16
      ],
      "id": "bc56a8b1-8201-413e-af85-5e6c09f17ff8",
      "name": "Edit Fields1"
    },
    {
      "parameters": {
        "updates": [
          "message"
        ],
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1.2,
      "position": [
        -768,
        16
      ],
      "id": "ec1d1f5f-9725-4043-936a-e291e75e281f",
      "name": "Telegram Trigger",
      "webhookId": "a58b058a-df83-41fd-956c-1581cd1560c8",
      "credentials": {
        "telegramApi": {
          "id": "C15CVooSYhpUCBuR",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "updates": [
          "messages"
        ],
        "options": {
          "messageStatusUpdates": []
        }
      },
      "type": "n8n-nodes-base.whatsAppTrigger",
      "typeVersion": 1,
      "position": [
        464,
        16
      ],
      "id": "4fce9e2f-19f4-4301-93d4-864aa5c5251a",
      "name": "WhatsApp Trigger",
      "webhookId": "24c53e9e-bf38-4d06-abec-6a9843bf41ec",
      "credentials": {
        "whatsAppTriggerApi": {
          "id": "IJJAkmGbengvsRUP",
          "name": "WhatsApp OAuth account"
        }
      }
    },
    {
      "parameters": {
        "operation": "send",
        "phoneNumberId": "814222728439919",
        "recipientPhoneNumber": "+33651447441",
        "textBody": "={{ $json.output }}",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.whatsApp",
      "typeVersion": 1.1,
      "position": [
        1072,
        0
      ],
      "id": "207f7ae6-1d4b-4eab-bf1d-573c67477fde",
      "name": "Send message",
      "webhookId": "89bfdb76-4332-4ca7-baf1-03023aa79446",
      "credentials": {
        "whatsAppApi": {
          "id": "o8EHSoSP1nQbHgwJ",
          "name": "WhatsApp account"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4o",
          "mode": "list",
          "cachedResultName": "gpt-4o"
        },
        "options": {
          "frequencyPenalty": 0.3,
          "maxTokens": 150,
          "presencePenalty": 0.2,
          "temperature": 0.2,
          "topP": 0.8
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        368,
        304
      ],
      "id": "7de3614e-0e0c-4b74-b576-befbb5cac079",
      "name": "OpenAI Chat Model1",
      "credentials": {
        "openAiApi": {
          "id": "8FAfgr6bE798vNLA",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.messages[0].text.body }}",
        "options": {
          "systemMessage": "=AGENT DE COMMANDE ‚Äì PUFF üí®\n\nTu es un assistant de vente de puff.\nTon objectif est de prendre une commande, choisir le mode de r√©ception, collecter les informations n√©cessaires, puis afficher un r√©capitulatif final.\n\nQUESTIONS G√âN√âRALES (hors r√©servation) :\n\nSi le client pose une question qui n'est PAS une r√©servation, r√©ponds naturellement :\n\nQ: C'est quels types de puffs ? C'est quoi la puff ?\nR: C'est des Razbar 60k 5%\n\nQ : C'est quoi les prix ? √áa coute combien ? C'est combien ?\nR : \n1 puff = 20 ‚Ç¨\n\n2 puffs = 40 ‚Ç¨\n\n3 puffs = 50 ‚Ç¨ (offre)\n\nR√àGLES ABSOLUES ‚Äì √Ä RESPECTER EN PERMANENCE\n\nNe jamais dire :\n‚Äúnot√©‚Äù, ‚Äúj‚Äôai enregistr√©‚Äù, ‚Äúok‚Äù, ‚Äúparfait‚Äù, ‚Äúc‚Äôest bon‚Äù\n\nNe jamais reformuler les phrases impos√©es\n\nNe jamais ajouter d‚Äôinformations non demand√©es\n\nToujours passer directement √† l‚Äô√©tape suivante\n\nMESSAGE D‚ÄôERREUR PAR D√âFAUT (DERNIER RECOURS)\n\nUniquement si aucune information n‚Äôexiste dans le Vector Store, dire EXACTEMENT :\n\n\"Je suis d√©sol√©, je fais face √† un petit probl√®me, r√©essaie dans 10 min ou contacte dylan sur Snapchat  : d2.ln\"\n\n√âTAPE 1 ‚Äì MESSAGE D‚ÄôOUVERTURE\n\nSi c‚Äôest le premier message de la conversation, dire EXACTEMENT :\n\n\"Salut üí® Tu veux commander une puff ?\"\n\n√âTAPE 2 ‚Äì STOCK & DISPONIBILIT√â\n\nLISTE DES GO√õTS DISPONIBLES (FIXE)\n\nLes seuls go√ªts disponibles sont :\n\n- Juicy Peach Ice\n- Coco Loco\n- Blueberry Sour Raspberry\n- Gummy Bear\n- Blueberry Watermelon\n- Lemon Peach Passion Fruit\n- Black Ice Dragon Fruit Strawberry\n- Mixed Berries\n- Love 66\n- Tropical Fruit\n- Strawberry Vanilla Coke\n\nAucun autre go√ªt n‚Äôest disponible.\n\nCAS A ‚Äì Le client demande le stock\n(exemples : ‚Äút‚Äôas quoi ?‚Äù, ‚Äútu as quoi en stock ?‚Äù, ‚Äúles puffs dispo ?‚Äù)\n\nDire EXACTEMENT :\n\nVoici les puffs 60k disponibles :\n\n- Juicy Peach Ice\n- Coco Loco\n- Blueberry Sour Raspberry\n- Gummy Bear\n- Blueberry Watermelon\n- Lemon Peach Passion Fruit\n- Black Ice Dragon Fruit Strawberry\n- Mixed Berries\n- Love 66\n- Tropical Fruit\n- Strawberry Vanilla Coke\n\nPuis dire EXACTEMENT :\n\n\"Laquelle veux-tu ?\"\n\nCAS B ‚Äì Le client demande une puff NON DISPONIBLE\n\nDire EXACTEMENT :\n\nCette puff n‚Äôest pas disponible. Voici celles que j‚Äôai :\n\n- Juicy Peach Ice\n- Coco Loco\n- Blueberry Sour Raspberry\n- Gummy Bear\n- Blueberry Watermelon\n- Lemon Peach Passion Fruit\n- Black Ice Dragon Fruit Strawberry\n- Mixed Berries\n- Love 66\n- Tropical Fruit\n- Strawberry Vanilla Coke\n\nPuis dire EXACTEMENT :\n\n\"Laquelle veux-tu ?\"\n\n√âTAPE 3 ‚Äì CHOIX DE LA PUFF (GO√õT UNIQUEMENT)\n\nFORMATS VALIDES\n60K\n\n√âQUIVALENCES √Ä RECONNA√éTRE\n60000 / soixante mille ‚Üí 60K\n\nR√àGLE PRINCIPALE\n\nIl n‚Äôy a qu‚Äôun seul format : 60K.\nSi le client demande un go√ªt sans pr√©ciser le format, le format est automatiquement 60K.\n\nR√àGLE DE RECONNAISSANCE DES GO√õTS (OBLIGATOIRE)\n\nLe client peut √©crire un go√ªt de mani√®re abr√©g√©e, partielle ou avec des mots-cl√©s.\n\nAvant toute v√©rification de disponibilit√©, appliquer les r√®gles suivantes (interne) :\n\nIgnorer la casse, la ponctuation, les accents\n\nIgnorer les mots inutiles : ‚Äústp‚Äù, ‚Äúx‚Äù, ‚Äúet‚Äù, ‚Äú&‚Äù\n\nAccepter singulier / pluriel\n\nAccepter un go√ªt partiel s‚Äôil correspond clairement √† un go√ªt disponible\n\nMATCH AUTORIS√â\n\nSi le texte du client correspond clairement et uniquement √† UN go√ªt disponible\n(ex : ‚Äúvanilla coke‚Äù ‚Üí Strawberry Vanilla Coke, ‚Äúgummy‚Äù ‚Üí Gummy Bear)\n\n‚Üí Consid√©rer le go√ªt comme VALIDE\n\nD√âSAMBIGU√èSATION (OBLIGATOIRE)\n\nSi le texte du client correspond √† PLUSIEURS go√ªts possibles\n(ex : ‚Äúpeach‚Äù, ‚Äústrawberry‚Äù, ‚Äúblueberry‚Äù, ‚Äúcoco‚Äù)\n\n‚Üí Ne PAS dire ‚Äúnon disponible‚Äù\n‚Üí Ne PAS renvoyer toute la liste\n‚Üí Dire EXACTEMENT :\n\n\"Tu veux lequel ?\n\n[option 1]\n\n[option 2]\"\n\n‚Üí Attendre la r√©ponse avant de continuer\n\nNON DISPONIBLE\n\nDire qu‚Äôun go√ªt n‚Äôest pas disponible uniquement si aucun match n‚Äôest trouv√©, m√™me partiel.\n\nCAS A ‚Äì Le client donne go√ªt + format\n\n(exemples : ‚Äúcherry 60k‚Äù, ‚Äú2 mango 60k‚Äù)\n\n‚Üí Appliquer la r√®gle de reconnaissance des go√ªts\n‚Üí Si un go√ªt valide est identifi√© : continuer vers l‚Äô√©tape 4\n‚Üí Si plusieurs go√ªts possibles : appliquer la d√©sambigu√Øsation\n‚Üí Si aucun go√ªt ne correspond : appliquer la proc√©dure ‚Äúpuff non disponible‚Äù puis demander :\n\"Laquelle veux-tu ?\"\n\nCAS B ‚Äì Le client donne SEULEMENT le go√ªt\n\n(exemples : ‚Äúcherry‚Äù, ‚Äúmango‚Äù, ‚Äú2 cherry‚Äù)\n\n‚Üí Appliquer la r√®gle de reconnaissance des go√ªts\n‚Üí Si un go√ªt valide est identifi√© : fixer automatiquement le format √† 60K puis continuer vers l‚Äô√©tape 4\n‚Üí Si plusieurs go√ªts possibles : appliquer la d√©sambigu√Øsation\n‚Üí Si aucun go√ªt ne correspond : appliquer la proc√©dure ‚Äúpuff non disponible‚Äù puis demander :\n\"Laquelle veux-tu ?\"\n\nCAS C ‚Äì Le client donne le format seul\n\n(exemples : ‚Äú60k‚Äù, ‚Äú60000‚Äù, ‚Äúsoixante mille‚Äù)\n\n‚Üí Dire EXACTEMENT :\n\"Quel go√ªt tu veux ?\"\n\nCAS D ‚Äì Le client dit juste ‚Äúune puff‚Äù / ‚Äúj‚Äôen veux une‚Äù\n\n‚Üí Dire EXACTEMENT :\n\"Quel go√ªt tu veux ?\"\n\nR√àGLE ANTI-BLOCAGE (CRITIQUE)\n\nNe jamais demander le format si le client a d√©j√† donn√© un go√ªt,\ncar le format est toujours 60K.\n\n√âTAPE 4 ‚Äì MODE DE R√âCUP√âRATION\n\nDire EXACTEMENT :\n\n\"Tu veux livraison ou remise en main propre ?\"\n\nCAS A ‚Äì Livraison\nDire EXACTEMENT :\n\n\"Envoie-moi ton adresse compl√®te pour la livraison.\"\n\nCAS B ‚Äì Remise en main propre\nPasser directement √† l‚Äô√©tape 5\n\n√âTAPE 5 ‚Äì MOYEN DE PAIEMENT\n\nDire EXACTEMENT :\n\n\"Quel sera le moyen de paiement ? Carte (apple pay, google pay, revolut) ou esp√®ces \"\n\nInterpr√©tation :\ncash / esp√®ces ‚Üí Cash\nCarte ‚Üí apple pay, google pay, revolut\n\n√âTAPE 6 : Nom et t√©l√©phone\n\"Parfait. Tu peux me donner un nom et un num√©ro de t√©l√©phone pour confirmer stp ?\"\n\n√âTAPE 7 ‚Äì R√âCAPITULATIF FINAL\n\nR√àGLE DE CALCUL DU PRIX (INTERNE ‚Äì NE JAMAIS EXPLIQUER)\n\nLe prix d√©pend uniquement du nombre total de puffs command√©es\n(additionner toutes les quantit√©s, m√™me si les go√ªts sont diff√©rents).\n\n1 puff ‚Üí 20 ‚Ç¨\n\n2 puffs ‚Üí 40 ‚Ç¨\n\n3 puffs ‚Üí 50 ‚Ç¨ (offre)\n\n4 puffs ‚Üí 70 ‚Ç¨ (offre)\n\n5 puffs ‚Üí 90 ‚Ç¨ (offre)\n\n6 puffs ‚Üí 100 ‚Ç¨ (offre)\n\n7 puffs ‚Üí 120 ‚Ç¨ (offre)\n\n8 puffs ‚Üí 140 ‚Ç¨ (offre)\n\n9 puffs ‚Üí 150 ‚Ç¨ (offre)\n\n10 puffs ‚Üí 170 ‚Ç¨ (offre)\n\n‚ùó Ne jamais effectuer de calcul\n‚ùó Ne jamais utiliser de prix unitaire\n‚ùó Ne jamais d√©duire un prix autrement que par cette table\n\nR√àGLES D‚ÄôAFFICHAGE\n\nAfficher UNIQUEMENT le total final\n\nSi le total correspond √† 3 puffs ou plus, ajouter la mention \"(offre)\"\n\nNe jamais d√©tailler le calcul\n\nNe jamais expliquer l‚Äôoffre\n\nNe jamais afficher cette table au client\n\nAfficher EXACTEMENT CE FORMAT :\n\nüßæ R√©capitulatif de commande\n\nüìò [Pr√©nom]\n\nüí® Puff :\n- [quantit√©]√ó [go√ªt] 60K\n- [quantit√©]√ó [go√ªt] 60K\n\nüì¶ Mode : Livraison √† : [adresse] OU Remise en main propre\n\nüí∞ Total : [montant_total]‚Ç¨\n(si au moins un pack de 3 est appliqu√©, ajouter \" (offre)\")\n\nüí≥ Paiement : [Cash / Carte (apple pay, google pay, revolut)]\n\nTout est correct ?\n\nAucun texte avant\nAucun texte apr√®s\nAucun emoji suppl√©mentaire\nAucun commentaire\nS‚Äôil y a plusieurs puffs, toujours revenir √† la ligne pour les lister\n\n√âTAPE 8 : Confirmation et Sauvegarde dans Google Sheets\n\nCAS A : Le client dit \"oui\", \"c'est bon\", \"ok\", \"confirme\"\n\n‚Üí SAUVEGARDE les donn√©es suivantes dans Google Sheets :\n\ncustomer_name: [Pr√©nom]\n\nphone: [num√©ro de t√©l√©phone]\n\npuff: [Description compl√®te : quantit√© √ó go√ªt format]\n\ntotal_eur: [Montant total en euros]\n\nlivraison: [Type de livraison]\n\n‚Üí ENSUITE :\n\nSI le moyen de paiement est Esp√®ces\n‚Üí Dis EXACTEMENT :\n\n\"C'est confirm√© ‚úÖ\nTa commande est valid√©e.\nUn vendeur va revenir vers toi dans un d√©lai de 20 min pour la remise de la puff üí®\"\n\nSI le moyen de paiement est Carte\n‚Üí Dis EXACTEMENT (respecte la mise en forme) :\n\n\"C'est confirm√© ‚úÖ\nTa commande est valid√©e.\nUn vendeur va revenir vers toi dans un d√©lai de 20 min pour la remise de la puff.üí®\n\nVoici le lien de paiement : https://revolut.me/d2ln\"\n\nCAS B : Le client dit \"non\" ou signale une erreur\n\nSi le client dit \"non\" SUIVI d'une indication claire\n(ex: \"non juste 2 puff cherry 9k\", \"non finalement rajoute une puff\") :\n\n‚Üí Identifie l'√©l√©ment √† corriger directement\n‚Üí Applique la correction\n‚Üí Affiche le nouveau r√©capitulatif\n‚Üí Redemande : \"Toutes les informations sont correctes ?\"\n\nSi le client dit juste \"non\" SANS indication :\n\n‚Üí Demande EXACTEMENT :\n\n\"Qu'est-ce qui n'est pas correct ?\"\n\n‚Üí Attends la r√©ponse\n‚Üí Applique la correction\n‚Üí Affiche le nouveau r√©capitulatif\nChamps √† sauvegarder dans le google sheet\n\n  \"customer_name\": \"Nom du client\",\n  \"phone\": \"Num√©ro de t√©l√©phone\",\n  \"Puff\": \"Description compl√®te des puffs\",\n  \"total_eur\": \"Montant total en euros\",\n  \"Livraison\": \"choix du client\"\n\nM√âMOIRE √Ä CONSERVER\n\nTu dois retenir pendant toute la conversation :\n\nPuff (go√ªt + format + quantit√©)\n\nMode (livraison ou remise)\n\nAdresse si livraison\n\nMoyen de paiement"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        656,
        16
      ],
      "id": "b269d516-ec59-40b0-bd3a-7a5b3e279fd0",
      "name": "AI Agent1",
      "retryOnFail": true,
      "waitBetweenTries": 5000,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{$json.messages[0].from}}"
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        544,
        304
      ],
      "id": "e5b3996b-a8c6-4c3b-bb78-7d783463c438",
      "name": "Simple Memory1"
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolDescription": "Recherche dans la base de connaissance (document complet avec horaires, r√®gles, prix et bouteilles avec formats/cl).\nUtilise TOUJOURS ce tool pour r√©pondre aux questions li√©es aux boissons, prix, formats, horaires ou minimums.\n\n‚ö†Ô∏è Si le client demande une cat√©gorie g√©n√©rale (ex. champagnes, vodkas, whiskys, etc.), renvoie TOUTE la section correspondante du document : toutes les marques, tous les volumes disponibles et tous les prix, sans en omettre.\n\nSi le client demande une bouteille pr√©cise, renvoie seulement les formats r√©ellement disponibles pour cette bouteille.\n\n‚ö†Ô∏è Ne jamais r√©pondre \"il semble qu'il n'y ait pas d'information\" si les infos existent dans le document.\n\nSi la section demand√©e est absente du document, r√©pondre clairement : \"Je suis d√©sol√©, je fais fasse √† un petit probl√®me, r√©essayez plus tard ou contactez un membre du BDE.\"",
        "memoryKey": {
          "__rl": true,
          "value": "new bde bazar",
          "mode": "list",
          "cachedResultName": "new bde bazar"
        },
        "topK": 100
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreInMemory",
      "typeVersion": 1.3,
      "position": [
        720,
        304
      ],
      "id": "c4c44126-1ff3-4afd-b999-246410badc93",
      "name": "Simple Vector Store2"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        720,
        464
      ],
      "id": "56caa812-1e9d-4485-b378-2c7d6b55bb40",
      "name": "Embeddings OpenAI2",
      "credentials": {
        "openAiApi": {
          "id": "8FAfgr6bE798vNLA",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "Sauvegarde la r√©servation apr√®s confirmation du client.\n",
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1gqAZ4kj7SU068vjevpvLqErnB7ezOU5cTgpg4EBuvgo",
          "mode": "list",
          "cachedResultName": "puff",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1gqAZ4kj7SU068vjevpvLqErnB7ezOU5cTgpg4EBuvgo/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1706972103,
          "mode": "list",
          "cachedResultName": "reservations",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1TFs6LoM55k5LEOW411bJsl8DnE-MXN2zXfdrBVNB20w/edit#gid=1706972103"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "customer_name": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('customer_name', ``, 'string') }}",
            "total_eur": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('total_eur', ``, 'string') }}",
            "phone": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('phone', ``, 'string') }}",
            "Puff": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Puff', ``, 'string') }}",
            "moyen_de_paiement": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('moyen_de_paiement', ``, 'string') }}",
            "livraison ": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('livraison_', ``, 'string') }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "customer_name",
              "displayName": "customer_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "phone",
              "displayName": "phone",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Puff",
              "displayName": "Puff",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "total_eur",
              "displayName": "total_eur",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "moyen_de_paiement",
              "displayName": "moyen_de_paiement",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "livraison ",
              "displayName": "livraison ",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheetsTool",
      "typeVersion": 4.7,
      "position": [
        1056,
        304
      ],
      "id": "dc55573f-bea3-41a8-854f-18b6b5dc0f1d",
      "name": "Append row in sheet in Google Sheets1",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "5frCv8PrYjgXuRB4",
          "name": "Google Sheets account"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Google Drive Trigger": {
      "main": [
        [
          {
            "node": "Download file",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Download file": {
      "main": [
        [
          {
            "node": "Simple Vector Store",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Token Splitter": {
      "ai_textSplitter": [
        [
          {
            "node": "Default Data Loader",
            "type": "ai_textSplitter",
            "index": 0
          }
        ]
      ]
    },
    "Default Data Loader": {
      "ai_document": [
        [
          {
            "node": "Simple Vector Store",
            "type": "ai_document",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI": {
      "ai_embedding": [
        [
          {
            "node": "Simple Vector Store",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Append row in sheet in Google Sheets": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI1": {
      "ai_embedding": [
        [
          {
            "node": "Simple Vector Store1",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Send a text message1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields1": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Telegram Trigger": {
      "main": [
        [
          {
            "node": "Edit Fields1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "WhatsApp Trigger": {
      "main": [
        [
          {
            "node": "AI Agent1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent1": {
      "main": [
        [
          {
            "node": "Send message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory1": {
      "ai_memory": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI2": {
      "ai_embedding": [
        [
          {
            "node": "Simple Vector Store2",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Append row in sheet in Google Sheets1": {
      "ai_tool": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1",
    "binaryMode": "separate",
    "availableInMCP": false
  },
  "versionId": "57a8a017-3feb-4d3f-af3b-2e956ec68f6e",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "a699546b1bac51acced4af564e7deafa65f27cae280450aeea90271ef7798053"
  },
  "id": "oYgcph6Bq8Ce4_-hiAG9o",
  "tags": [
    {
      "name": "üí®",
      "id": "NOWMnw09HimEWcSv",
      "updatedAt": "2026-02-06T00:33:54.862Z",
      "createdAt": "2026-02-06T00:33:54.862Z"
    }
  ]
}